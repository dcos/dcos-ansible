# DC/OS System Requirements as of https://docs.mesosphere.com/1.11/installing/production/system-requirements/
- name: "Finding the provider / environment running on (AWS, GCP, AzureRM or, if nothing detected, on premise)"
  # AWS 4th gen or earlier, Xen based types:
  #   looking at `product_version` or `bios_verion`.
  # AWS 5th gen HVM based instance types:
  #   looking at `system_vendor`.
  set_fact:
    dcos_environment: >-
        {{
          (
            ('amazon' in ansible_product_version) or
            ('amazon' in ansible_bios_version) or
            ('EC2' in ansible_system_vendor)
          ) | ternary('ec2', (('Google' in ansible_system_vendor) | ternary('gcp', (('Microsoft Corporation' in ansible_system_vendor) | ternary('azurerm', 'onprem')))))
        }}
  changed_when: false

- name: "Determine if system is CoreOS/Flatcar Linux"
  set_fact:
    is_flatcar: "{{ ansible_distribution == 'Coreos' or ansible_distribution == 'Flatcar Container Linux by Kinvolk' or ansible_distribution == 'Flatcar Linux by Kinvolk' }}"
  changed_when: false

- include_tasks: EL.yml
  when: not is_flatcar

- include_tasks: Flatcar.yml
  when: is_flatcar